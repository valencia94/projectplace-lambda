name: Convert All Docx to PDF

on:
  workflow_dispatch: {}  # so you can run it manually

jobs:
  convert-all-docs:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout source
        uses: actions/checkout@v3

      - name: üîê Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-2  # or your region

      - name: üèó Install LibreOffice
        run: |
          sudo apt-get update
          sudo apt-get install -y libreoffice

      - name: üì• Download all docx from S3
        run: |
          # We'll sync only *.docx from s3://<bucket>/actas to a local folder
          mkdir -p actas
          aws s3 sync s3://projectplace-dv-2025-x9a7b/actas actas --exclude "*" --include "*.docx"
          ls -l actas

      - name: üñ® Convert .docx to .pdf
        run: |
          cd actas
          # For each .docx, convert to .pdf in the same directory
          for f in *.docx; do
            echo "Converting $f to PDF..."
            libreoffice --headless --convert-to pdf "$f" 
          done
          ls -l

      - name: üöÄ Upload PDFs back to S3
        run: |
          # Now we sync all *.pdf from our local "actas/" back to "s3://.../actas"
          aws s3 sync actas s3://projectplace-dv-2025-x9a7b/actas \
            --exclude "*" \
            --include "*.pdf" \
            --content-type "application/pdf" \
            --content-disposition "attachment"
          echo "Done uploading PDF!"
